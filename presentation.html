<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Communicating results with ggplot2 and Rmarkdown</title>
    <meta charset="utf-8" />
    <meta name="author" content="Emma Skarstein" />
    <script src="presentation_files/header-attrs/header-attrs.js"></script>
    <link href="presentation_files/countdown/countdown.css" rel="stylesheet" />
    <script src="presentation_files/countdown/countdown.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="my_theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Communicating results with <strong>ggplot2</strong> and <strong>Rmarkdown</strong>
]
.subtitle[
## TMA4265 Stochastic modelling
]
.author[
### Emma Skarstein
]
.date[
### Fall 2022
]

---






# Goal for today

Overall

- **Create reproducible reports in R using Rmarkdown**

--

In addition, we will learn how to

- make beautiful plots in ***ggplot2***
- use ***Github*** for collaboration


---
class: inverse, center, middle

# Get Started with **R Markdown**

---
# Why R Markdown?

1. R code can be directly integrated in the report
2. Useful for anyone who uses R and wants to communicate results
3. With numerous packages that build on it, it is really easy to create beautiful reports, slides, websites, etc.

**Examples**

- [I made an R Markdown file to explain the code for my **master thesis**](https://htmlpreview.github.io/?https://github.com/emmaSkarstein/Citizen_Science_Skarstein_master/blob/master/reports/Short_version_master.html)
- [**Supplementary material** for academic articles](https://github.com/emmaSkarstein/ISBA2022-Poster/tree/main/Simulation_example)
- [Using R packages and education to scale Data Science at **Airbnb**](https://medium.com/airbnb-engineering/using-r-packages-and-education-to-scale-data-science-at-airbnb-906faa58e12d)

---
# First steps

Download the `rmarkdown` package:

```r
install.packages("rmarkdown")
```

.pull-left[
Then, in R Studio, click the new-document-button, and choose "R Markdown".

Enter the title you want, and you now have an R Markdown document!
]

.pull-right[
&lt;img src="figs/dropdown.png" width="40%" /&gt;
]

---
# Try it yourself

Open RStudio and create an R Markdown document.

- Name it whatever you want
- Choose **HTML** to start with

<div class="countdown" id="timer_af9c34fb" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">02</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
# Structure of an R Markdown document

.pull-left[
The **YAML** is the part at the top in between "---"

Some things you could add:
- subtitle
- if making a PDF, this is where you could [add LaTeX packages](https://bookdown.org/yihui/rmarkdown-cookbook/latex-extra.html#loading-latex-packages)

**The body** begins with the `setup` chunk, here we can specify global options.

Look at the template: section titles and code chunks
]


.pull-right[
![](figs/rmarkdown_template.png)
]

---
# Code chunks

.pull-left[
***Lifesaver:*** Shortcut for creating code chunk is 
.small[
- Windows/Linux: **Ctrl+Alt+I**
- macOS: **Command+Option+I**

[You can find more keyboard shortcuts here.](https://bookdown.org/yihui/rmarkdown-cookbook/rstudio-shortcuts.html)
 ]

Note the options in the curly-brackets:
.small[
- `include = FALSE`: code and results will not be shown, but the code will be run.
- `echo = FALSE`: hides the code, but not the results (useful for figures).
- `eval = FALSE`: code is shown, but not run. 
- `message = FALSE`: hides messages generated by code (useful for when loading packages).
- `warning = FALSE`: hides warnings generated by code
- `fig.cap = "..."`: Sets figure caption for figure generated in that chunk
- `out.width="x%"`: Scales the figure size with x%
 ]
]

.pull-right[
![](figs/rmarkdown_template.png)
Chunk options can be set *globally* in the `setup` chunk if you want them to apply to all code chunks.
]

---
# Try it yourself

- Knit the template R Markdown file that is generated automatically for you. 
- Feel free to change the chunk options and change what is visible.

<div class="countdown" id="timer_abf44b10" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">02</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>

---
# Including formulas

**In-line formula:** `$X \sim Pois(\lambda)$` becomes `\(X \sim Pois(\lambda)\)`.

**Equation on separate line: **

`$$` `X \sim Pois(\lambda)$$` becomes

$$
X \sim Pois(\lambda)
$$
**Equation aligned over several lines: **

Use `\begin{aligned}` and `\end{aligned}`.

`$$`
`\begin{aligned}` ` X &amp;\sim \\ &amp;Pois(\lambda) \end{aligned}$$` 

becomes
`$$\begin{aligned} X &amp;\sim \\ &amp;Pois(\lambda) \end{aligned}$$`
---
# Knitting the document

To create the document, press the **Knit** button.

For courses at NTNU, we generally want you to hand in **PDF** documents, since that lets us view comment in your file directly in Blackboard. 

[In order to create a PDF document](https://bookdown.org/yihui/rmarkdown-cookbook/install-latex.html), you will need to have a LaTeX distribution installed. One option is TinyTeX, which you can install easily with the R package tinytex:


```r
tinytex::install_tinytex()
```

.pull-left[
**HTML document**

```yaml
---
title: "A nice report"
author: "Emma Skarstein"
date: "Fall 2022"
output: html_document 
---
```
]

.pull-right[
**PDF document**

```yaml
---
title: "A nice report"
author: "Emma Skarstein"
date: "Fall 2022"
output: pdf_document
---
```
]

---
# Resources

You now should know enough to be able to use R Markdown for this course! There are tons of resources out there, and if you have any problems someone has most likely had the same problem before you, so you can solve most issues by googling.

Here are also some resources that cover R Markdown, both the very basic level and some very advanced stuff.

[**R Markdown tutorial** from RStudio](https://rmarkdown.rstudio.com/lesson-1.html)

[**R Markdown Cookbook** by Yihui Xie, Christophe Dervieux, Emily Riederer](https://bookdown.org/yihui/rmarkdown-cookbook/)  - has many short, practical examples, I link to several in this presentation!

[**R Markdown: The Definitive Guide** by Yihui Xie, J. J. Allaire, Garrett Grolemund](https://bookdown.org/yihui/rmarkdown/) - Chapter 2 should be sufficient for this course

[**R Markdown Cheatsheet**](https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf) 

---
# Further opportunities with R Markdown
(Note: This is super optional, and just if you find it fun. You absolutely do not need anything more than the basic report in this course.)

- [Presentation slides](https://rmarkdown.rstudio.com/lesson-11.html) with `beamer`, `ioslides`, `slidy` or others.
  - This presentation was made in R Markdown using [`Xaringan`](https://bookdown.org/yihui/rmarkdown/xaringan.html)

- Basic webpage with [`postcards`](https://github.com/seankross/postcards)

- Websites/blogs with [`Distill`](https://rstudio.github.io/distill/website.html) (can also be combined with `postcards`.)

- Many of templates for paged HTML documents (thesis, CV, poster, etc.) with [`pagedown`](https://github.com/rstudio/pagedown) 



---
class: inverse, center, middle

# Get Started with `ggplot2`

---
# Why `ggplot2`?

- It gives you a recognizable system - when you have understood the structure of `ggplot2` it is very easy to understand how to modify things to get exactly the plot you want. 

---
# First steps

Install the `ggplot2` package:


```r
install.packages("ggplot2")
```

Load the package:


```r
library(ggplot2)
```

For this tutorial, I'll use the `palmerpenguins` dataset, which you can install and load in the same way:


```r
install.packages("palmerpenguins")
```

```r
library(palmerpenguins)
```

---
# A simple plot

Let's first take a look at the structure of our data.


```r
head(penguins)
```

```
## # A tibble: 6 × 8
##   species island    bill_length_mm bill_depth_mm flipper_l…¹ body_…² sex    year
##   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;       &lt;int&gt;   &lt;int&gt; &lt;fct&gt; &lt;int&gt;
## 1 Adelie  Torgersen           39.1          18.7         181    3750 male   2007
## 2 Adelie  Torgersen           39.5          17.4         186    3800 fema…  2007
## 3 Adelie  Torgersen           40.3          18           195    3250 fema…  2007
## 4 Adelie  Torgersen           NA            NA            NA      NA &lt;NA&gt;   2007
## 5 Adelie  Torgersen           36.7          19.3         193    3450 fema…  2007
## 6 Adelie  Torgersen           39.3          20.6         190    3650 male   2007
## # … with abbreviated variable names ¹​flipper_length_mm, ²​body_mass_g
```



```r
names(penguins)
```

```
## [1] "species"           "island"            "bill_length_mm"   
## [4] "bill_depth_mm"     "flipper_length_mm" "body_mass_g"      
## [7] "sex"               "year"
```

---
# A simple plot


```r
ggplot(data = penguins, 
       aes(x = flipper_length_mm, y = body_mass_g))
```
.pull-left[
&lt;img src="presentation_files/figure-html/unnamed-chunk-12-1.png" width="90%" /&gt;
]
.pull-right[
Lets say we want to plot the flipper length against body mass. We use the `ggplot()` function, and specify the data set, and what we want on the x- and y-axis. If we run this, we see the initialized plot.
]

---
# A simple plot - Adding points


```r
ggplot(data = penguins, 
       aes(x = flipper_length_mm, y = body_mass_g)) +
* geom_point()
```

.pull-left[
&lt;img src="presentation_files/figure-html/unnamed-chunk-14-1.png" width="90%" /&gt;
]

.pull-right[
To get the actual data on the plot, we need to specify `geom_point()`. The layers of a `ggplot` are added together with a **`+`**. 
]

---
# A simple plot - Color by species


```r
ggplot(data = penguins, 
       aes(x = flipper_length_mm, y = body_mass_g)) +
* geom_point(aes(color = species))
```

.pull-left[
&lt;img src="presentation_files/figure-html/unnamed-chunk-16-1.png" width="90%" /&gt;
]

.pull-right[
To color the points by species, add `aes(color = species)` inside `geom_point()`. 
]

---
# A simple plot - Themes


```r
ggplot(data = penguins, 
       aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point(aes(color = species)) +
* theme_minimal()
```

.pull-left[
&lt;img src="presentation_files/figure-html/unnamed-chunk-18-1.png" width="90%" /&gt;
]

.pull-right[
We can make changes to the layout of the plot by specifying a different theme. The default is `theme_gray()`, let's change it to `theme_bw()`. 
]

---
# A simple plot - Color palettes


```r
ggplot(data = penguins, 
       aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point(aes(color = species)) +
  scale_color_manual(values = c("orange", "darkcyan", "hotpink"))
  theme_minimal() 
```

.pull-left[
&lt;img src="presentation_files/figure-html/unnamed-chunk-20-1.png" width="90%" /&gt;
]

.pull-right[
The color palette can be changed through `scale_color_...()`. In this case, we want to specify manual values for the colors, but you could also use ready-made color palettes, [there are lots of them!](https://emilhvitfeldt.github.io/r-color-palettes/discrete.html)
]

---

# A simple plot - Fonts


```r
library(showtext)
showtext_auto()
font_add_google(name = "Josefin Sans", family = "Josefin Sans")
```

The package `showtext` is great for changing fonts.

---

# A simple plot - Fonts


```r
ggplot(data = penguins, 
       aes(x = flipper_length_mm, y = body_mass_g)) +
  geom_point(aes(color = species)) +
  scale_color_manual(values = c("orange", "darkcyan", "hotpink")) +
  theme_bw() +
  theme(text = element_text(family = "Josefin Sans"))
```

.pull-left[
&lt;img src="presentation_files/figure-html/unnamed-chunk-23-1.png" width="90%" /&gt;
]

.pull-right[
Just putting some text here now
]

---
# More penguin plots

You can see some more examples of `ggplot2` plots with the `palmerpenguin` data [here](https://allisonhorst.github.io/palmerpenguins/articles/examples.html).

![](figs/penguins_vignette.png)

---

class: center, middle

# Thanks!

Slides created via the R package [`xaringan`](https://github.com/yihui/xaringan).

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "solarized-dark",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
